<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Model Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #ffffff;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(255, 255, 255, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 100;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="info">
            <h3>Brain Model Test</h3>
            <p>Mouse: Rotate the brain</p>
            <p>Scroll: Zoom in/out</p>
            <p>Right click + drag: Pan</p>
        </div>
        <div id="loading">Loading brain model...</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <script>
        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.getElementById('container').appendChild(renderer.domElement);

        // Camera position
        camera.position.set(0, 0, 5);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 5, 5);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        scene.add(directionalLight);

        // Add some colored lights for better visualization
        const redLight = new THREE.PointLight(0xff4444, 0.5, 10);
        redLight.position.set(3, 2, 3);
        scene.add(redLight);

        const blueLight = new THREE.PointLight(0x4444ff, 0.5, 10);
        blueLight.position.set(-3, -2, -3);
        scene.add(blueLight);

        // Controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.screenSpacePanning = false;
        controls.minDistance = 1;
        controls.maxDistance = 20;
        controls.maxPolarAngle = Math.PI;

        // Load the brain model
        const loader = new THREE.GLTFLoader();
        
        // Set up DRACO loader for compressed models
        const dracoLoader = new THREE.DRACOLoader();
        dracoLoader.setDecoderPath('https://www.gstatic.com/draco/versioned/decoders/1.4.1/');
        loader.setDRACOLoader(dracoLoader);
        
        let brainModel = null;

        loader.load(
            'brain-small.glb',
            function (gltf) {
                brainModel = gltf.scene;
                
                // Center and scale the model
                const box = new THREE.Box3().setFromObject(brainModel);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());
                
                // Scale to fit nicely in view
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 2 / maxDim;
                brainModel.scale.setScalar(scale);
                
                // Center the model
                brainModel.position.sub(center.multiplyScalar(scale));
                
                // Enable shadows for all meshes
                brainModel.traverse(function (child) {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                        
                        // Add some material properties for better appearance
                        if (child.material) {
                            child.material.metalness = 0.1;
                            child.material.roughness = 0.8;
                        }
                    }
                });
                
                scene.add(brainModel);
                
                // Hide loading message
                document.getElementById('loading').style.display = 'none';
                
                console.log('Brain model loaded successfully');
            },
            function (xhr) {
                console.log((xhr.loaded / xhr.total * 100) + '% loaded');
                document.getElementById('loading').textContent = 
                    'Loading brain model... ' + Math.round(xhr.loaded / xhr.total * 100) + '%';
            },
            function (error) {
                console.error('Error loading brain model:', error);
                document.getElementById('loading').textContent = 'Error loading brain model';
            }
        );

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Rotate the brain slowly if no user interaction
            if (brainModel && !controls.getAzimuthalAngle()) {
                brainModel.rotation.y += 0.005;
            }
            
            controls.update();
            renderer.render(scene, camera);
        }

        // Handle window resize
        window.addEventListener('resize', onWindowResize, false);

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Start animation
        animate();
    </script>
</body>
</html> 